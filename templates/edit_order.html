<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <title>Rediger ordre</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        .edit-box {
            max-width: 600px;
            margin: auto;
        }

        .item-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            align-items: center;
        }

        .item-row input {
            width: 70px;
            padding: 6px;
            text-align: center;
        }

        .price {
            opacity: 0.7;
        }

        .total {
            font-size: 1.4em;
            font-weight: bold;
            margin-top: 20px;
            text-align: right;
        }
    </style>
</head>
<body>

<div class="card edit-box">
    <h2>‚úèÔ∏è Rediger ordre</h2>

    <form method="post" id="orderForm">
        {% for item, amount in order["items"].items() %}
        <div class="item-row">
            <span>{{ item }}</span>
            <input
                type="number"
                min="0"
                name="{{ item }}"
                value="{{ amount }}"
                data-price="{{ prices[item] }}"
                onchange="updateTotal()"
                onkeyup="updateTotal()"
            >
            <span class="price">{{ prices[item] }} kr</span>
        </div>
        {% endfor %}

        <div class="total">
            Total: <span id="totalPrice">{{ order.total }}</span> kr
        </div>

        <button class="btn primary" type="submit">
            üíæ Gem √¶ndringer
        </button>
    </form>
</div>

<script>
function updateTotal() {
    let total = 0;
    document.querySelectorAll("input[data-price]").forEach(input => {
        const amount = parseInt(input.value) || 0;
        const price = parseInt(input.dataset.price);
        total += amount * price;
    });
    document.getElementById("totalPrice").innerText = total;
}
</script>
<script>
let lastHash = null;

async function poll() {
    const res = await fetch("/session_data/{{ session }}");
    const data = await res.json();
    if (lastHash && lastHash !== data.hash) {
        location.reload();
    }
    lastHash = data.hash;
}
setInterval(poll, 2000);
</script>

</body>
</html>
