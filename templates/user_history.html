{% extends "base.html" %}
{% block content %}

{% if stats %}
<!-- ================= USER HEADER ================= -->
<div class="card user-header">
    <div class="avatar-wrapper" style="position:relative; width:120px; margin:auto;">
    <img
        src="https://cdn.discordapp.com/avatars/{{ uid }}/{{ user_info.avatar }}.png"
        onerror="this.src='https://cdn.discordapp.com/embed/avatars/0.png'"
        style="width:120px; height:120px; border-radius:50%; border:3px solid #444;"
    >

    {% if stats.locked %}
    <div style="
        position:absolute;
        inset:0;
        background:rgba(0,0,0,0.65);
        border-radius:50%;
        display:flex;
        align-items:center;
        justify-content:center;
        font-weight:bold;
        color:#ff4d4d;
        font-size:1.1em;
        letter-spacing:1px;
    ">
        ğŸ”’ LÃ…ST
    </div>
    {% endif %}
</div>


    <div class="user-header-right">
        <h2>{{ user_info.name }}</h2>

        <span class="badge {% if user_info.role == 'admin' %}admin{% else %}user{% endif %}">
            {% if user_info.role == "admin" %}
                ğŸ›¡ï¸ Admin
            {% else %}
                ğŸ‘¤ Bruger
            {% endif %}
        </span>

        <p class="muted">Discord ID: {{ uid }}</p>

        <div class="actions">
            {% if uid in locked_users %}
                <a class="btn success" href="/admin/unlock/{{ uid }}">ğŸ”“ LÃ¥s op</a>
            {% else %}
                <a class="btn danger" href="/admin/lock/{{ uid }}">ğŸ”’ LÃ¥s</a>
            {% endif %}
        </div>
    </div>
</div>

<!-- ================= STATS ================= -->
<div class="grid stats-grid">
    <div class="card stat">
        <h4>ğŸ’° Samlet brugt</h4>
        <p class="stat-value">{{ "{:,}".format(stats.total_spent) }} kr</p>
    </div>

    <div class="card stat">
        <h4>ğŸ“¦ Varer kÃ¸bt</h4>
        <p class="stat-value">{{ stats.total_items }} stk</p>
    </div>

    <div class="card stat">
        <h4>â­ Mest kÃ¸bt</h4>
        <p class="stat-value">{{ stats.most_bought or "â€”" }}</p>
    </div>
</div>
{% endif %}

<!-- ================= SEARCH ================= -->
<div class="card">
    <form method="get" class="actions">
        <input type="text"
               name="uid"
               placeholder="Discord ID"
               value="{{ uid or '' }}"
               style="min-width:300px;">
        <button class="btn blue">ğŸ” SÃ¸g</button>
    </form>
</div>

<!-- ================= ORDERS ================= -->
<h2>ğŸ“œ Ordrehistorik</h2>

{% if orders %}
<div class="grid">
    {% for o in orders %}
    <div class="card order-card">
        <div class="order-header">
            <strong>ğŸ“¦ {{ o.session }}</strong>
            <span class="muted">{{ o.time }}</span>
        </div>

        <ul class="order-items">
            {% for item, amount in o["items"].items() %}
                {% if amount > 0 %}
                    <li>{{ item }} Ã— {{ amount }}</li>
                {% endif %}
            {% endfor %}
        </ul>

        <div class="order-total">
            {{ "{:,}".format(o.total) }} kr
        </div>
    </div>
    {% endfor %}
</div>

<div class="card total-card">
    <h3>ğŸ’° Samlet total</h3>
    <p class="grand-total">{{ "{:,}".format(grand_total) }} kr</p>
</div>
{% else %}
<p class="muted">Ingen ordrer fundet for denne bruger.</p>
{% endif %}

<div class="actions">
    <a class="btn" href="/admin/users">â¬…ï¸ Tilbage til brugere</a>
</div>

{% endblock %}
