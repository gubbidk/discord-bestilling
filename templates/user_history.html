{% extends "base.html" %}
{% block content %}

{% if user_info %}
<div class="user-stats">

    <div class="avatar">
        <img src="https://cdn.discordapp.com/avatars/{{ uid }}/{{ user_info.avatar or '' }}.png"
             onerror="this.src='/static/default_avatar.png'">
    </div>

    <h3>{{ user_info.name }}</h3>

    <div class="stats-box">
        <p><strong>Rolle:</strong>
            {% if user_info.role == "admin" %}
                ğŸ›¡ï¸ Admin
            {% else %}
                ğŸ‘¤ Bruger
            {% endif %}
        </p>

        <p><strong>Samlet brugt:</strong><br>
            {{ "{:,}".format(stats.total_spent) }} kr
        </p>

        <p><strong>Varer kÃ¸bt:</strong><br>
            {{ stats.total_items }} stk
        </p>

        <p><strong>Mest kÃ¸bt:</strong><br>
            {{ most_bought or "â€”" }}
        </p>

        <div class="actions">
            {% if uid in locked_users %}
                <a class="btn success" href="/admin/unlock/{{ uid }}">ğŸ”“ LÃ¥s op</a>
            {% else %}
                <a class="btn danger" href="/admin/lock/{{ uid }}">ğŸ”’ LÃ¥s</a>
            {% endif %}
        </div>
    </div>
</div>
{% endif %}

<h2>ğŸ“œ Brugerhistorik</h2>

{% if uid %}
<p class="muted">
    Discord ID: <strong>{{ uid }}</strong>
</p>
{% endif %}

<form method="get" class="actions">
    <input type="text"
           name="uid"
           placeholder="Discord ID"
           value="{{ uid or '' }}"
           style="min-width:300px;">
    <button class="btn blue">ğŸ” SÃ¸g</button>
</form>

<hr>

{% if uid %}
    {% if orders %}
        <div class="grid">
        {% for o in orders %}
            <div class="card">
                <h3>ğŸ“¦ {{ o.session }}</h3>
                <p class="muted">{{ o.time }}</p>

                <ul>
                    {% for item, amount in o.items.items() %}
                        {% if amount > 0 %}
                            <li>{{ item }} Ã— {{ amount }}</li>
                        {% endif %}
                    {% endfor %}
                </ul>

                <p><strong>Total:</strong> {{ "{:,}".format(o.total) }} kr</p>
            </div>
        {% endfor %}
        </div>
    {% else %}
        <p>Ingen ordrer fundet for denne bruger.</p>
    {% endif %}
{% else %}
    <p>Indtast et Discord-ID for at se historik.</p>
{% endif %}

{% if orders %}
<div class="card">
    <h3>ğŸ’° Samlet total</h3>
    <p style="font-size:1.3em;">
        {{ "{:,}".format(grand_total) }} kr
    </p>
</div>
{% endif %}

<div class="actions">
    <a class="btn" href="/admin/users">â¬…ï¸ Tilbage til brugere</a>
</div>

{% endblock %}
