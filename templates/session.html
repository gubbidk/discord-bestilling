{% extends "base.html" %}
{% block content %}

<h2>ğŸ“¦ {{ name }}</h2>

<div class="summary">
    <div class="summary-card">
        <span>Total pris</span>
        <strong>{{ total }} kr</strong>
    </div>
</div>

{% if orders|length == 0 %}
<p class="muted">Ingen ordrer endnu</p>
{% endif %}

{% for o in orders %}
<div style="display:flex;align-items:center;gap:10px;">
    {% if o.discord_id %}
    <img
        src="https://cdn.discordapp.com/avatars/{{ o.discord_id }}/{{ o.avatar }}.png"
        onerror="this.style.display='none'"
        style="width:32px;height:32px;border-radius:50%;">
    {% endif %}

    <h3>{{ o.user }}</h3>
</div>

    <table>
        <tr>
            <th>Item</th>
            <th>Antal</th>
        </tr>

        {% for item, amount in o["items"].items() %}
        {% if amount > 0 %}
        <tr>
            <td>{{ item }}</td>
            <td>{{ amount }}</td>
        </tr>
        {% endif %}
        {% endfor %}
    </table>

    <div class="order-footer">
        <strong>{{ o.total }} kr</strong>

        {% if session.admin %}
        <div class="actions">
{% if session.admin %}

<a class="btn small" href="/edit_order/{{ name }}/{{ o.id }}">
    âœï¸ Rediger
</a>

<a class="btn small danger" href="/delete_order/{{ name }}/{{ o.id }}">
    ğŸ—‘ï¸ Slet
</a>

{% if o.discord_id %}
<a class="btn small warning"
   href="/admin/block/{{ o.discord_id }}"
   onclick="return confirm('BlokÃ©r bruger fra web?')">
   ğŸš« BlokÃ©r
</a>

<a class="btn small success"
   href="/admin/unblock/{{ o.discord_id }}"
   onclick="return confirm('Fjern blokering?')">
   ğŸ”“ Fjern blok
</a>
{% endif %}

{% endif %}
</div>



</div>
{% endfor %}

<script>
let lastHash = null;

async function checkUpdates() {
    const res = await fetch("/session_data/{{ name }}");
    const data = await res.json();

    if (lastHash === null) {
        lastHash = data.hash;
        return;
    }

    if (data.hash !== lastHash) {
        location.reload();
    }
}

setInterval(checkUpdates, 3000);
</script>

{% endblock %}
